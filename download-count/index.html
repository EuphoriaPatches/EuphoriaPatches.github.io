<!DOCTYPE html>
<html lang="en">
<head>


    <!-- Basic Page Needs
    ================================================== -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="canonical" href="https://www.euphoriapatches.com/download-count/"/>

    <title>Download Count | Euphoria Patches</title>

    <meta name="description" content="Total Download Counter">
    <meta name="author" content="">
    <meta name="keywords" content="">

    <!-- Mobile Specific Metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=5.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">

    <!-- Favicon
    ================================================== -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/EuphoriaPatchesLogo_180x.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/EuphoriaPatchesLogo_16x.png">

    <!-- Stylesheets
    ================================================== -->
    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/assets/css/style.min.css" rel="stylesheet">
    <link href="/assets/css/responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Cookie Consent Script -->
    <script src="/assets/js/cookie-consent.js" async></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
<div id="custom-cursor"></div> <!-- Custom Cursor -->
<div id="download-counter-all-page">
    <header id="masthead" class="site-header site-header-white">
        <nav id="primary-navigation" class="site-navigation download-count-nav-footer">
            <div class="container">

                <div class="navbar-header">
                   
                    <a href="/" class="site-title"><span>Euphoria</span> Patches</a>

                </div><!-- /.navbar-header -->

                <div class="collapse navbar-collapse" id="agency-navbar-collapse">

                    <ul class="nav navbar-nav navbar-right">

                        <li><a href="/">Home</a></li>
                        <li><a class="download-navigation-button" href="/download">Download</a></li>
                        <li><a href="/support">Preview Versions</a></li>
                        <li><a href="/gallery">Gallery</a></li>
                        <li><a href="/how-to-install">How To Install</a></li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Information<i class="fa fa-caret-down hidden-xs" aria-hidden="true"></i></a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                              <li><a href="/contact">Contact</a></li>
                              <li><a href="/changelogs">Changelogs</a></li>
                              <li><a href="/faq">FAQ</a></li>
                              <li><a href="/credits">Credits</a></li>
                              <li><a href="/download-count/" style="color: var(--ThemeColor);">Download Count</a></li>
                              <li><a href="/privacy-policy">Privacy Policy</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>   
        </nav><!-- /.site-navigation -->
    </header><!-- /#mastheaed -->

    <main id="main" class="site-main download-page-main">
        <section class="site-section gradient-bg">
            <div class="download-counter-page">
                <img src="/assets/img/other/euphoria_patches_alone_banner.svg" alt="Euphoria Patches Banner" class="download-count-image" width="48%" height="auto">
                <h2>Total Downloads:</h2>
                <div class="total-download-number">
                    <div class="typed-out" id="typed-out">
                        <h1 id="download-counter">&nbsp;</h1>
                    </div>
                    <div id="download-details" class="download-details">
                        <div id="modrinth-downloads">&nbsp;</div>
                        <div id="curseforge-downloads">&nbsp;</div>
                        <div id="daily-avg">&nbsp;</div>
                    </div>
                </div>
            </div>
        </section>
    </main>


    <footer id="colophon" class="site-footer"></footer>
        <div class="copyright download-count-nav-footer">
            <div class="container">
                <div class="row">
                    <div class="col-xs-8">
                        <div class="social-links">
                            <a class="discord-bg" href="/discord" target="_blank" alt="Discord Invite"></a>
                            <a class="patreon-bg" href="/support" target="_blank" alt="Patreon Link"></a>
                            <a class="github-bg" href="/github" target="_blank" alt="Github Link"></a>
                            <a class="contact-bg" href="/contact" target="_blank" alt="Contact Page Link">Contact</a>
                        </div><!-- /.social-links -->
                    </div>
                    <div class="col-xs-4 site-title">
                        <div class="text-right">
                            <a href="/">Euphoria Patches</a>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- /.copyright -->
    </footer><!-- /#footer -->
</div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/bootstrap-select.min.js"></script>
    <script src="/assets/js/jquery.slicknav.min.js"></script>
    <script src="/assets/js/jquery.countTo.min.js"></script>
    <script src="/assets/js/jquery.shuffle.min.js"></script>
    <script src="/assets/js/script.js"></script>

    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js";
    
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBheyXP71wW38Pr1Pz7td5fA1ceNF7I-4U",
            authDomain: "ep-website-backend.firebaseapp.com",
            databaseURL: "https://ep-website-backend-default-rtdb.firebaseio.com",
            projectId: "ep-website-backend",
            storageBucket: "ep-website-backend.appspot.com",
            messagingSenderId: "527249989649",
            appId: "1:527249989649:web:7c4913be47d320cbb891b0",
            measurementId: "G-W72RZF1WBJ"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
    
        // Fetch Modrinth Downloads
        async function fetchModrinthDownloads(projectId) {
            try {
                const response = await fetch(`https://api.modrinth.com/v2/project/${projectId}`);
                const data = await response.json();
                return data.downloads || 0;
            } catch (error) {
                console.error('Error fetching Modrinth downloads:', error);
                return 0;
            }
        }
    
        // Fetch CurseForge Downloads
        async function fetchCurseforgeDownloads(projectId) {
            try {
                const response = await fetch(`https://api.curseforge.com/v1/mods/${projectId}`, {
                    headers: {
                        'Accept': 'application/json',
                        'x-api-key': '$2a$10$izPaCsTGxUGv.3h62ZixYelNErqfLizoCjVJphyCNFs00riMLc5wK'
                    }
                });                
                const data = await response.json();
                return data.data.downloadCount || 0;
            } catch (error) {
                console.error('Error fetching Curseforge downloads:', error);
                return 0;
            }
        }

        function timeUntilTransfer() {
            const now = new Date(), utcOffset = 1;
            let msUntilTarget = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), utcOffset) - now.getTime();
            if (msUntilTarget < 0) msUntilTarget += 86400000; // Add 24 hours in milliseconds if the target is in the past
            return {
                hours: Math.floor(msUntilTarget / 3600000),
                minutes: Math.floor((msUntilTarget % 3600000) / 60000),
                seconds: Math.floor((msUntilTarget % 60000) / 1000)
            };
        }

        const { hours, minutes, seconds } = timeUntilTransfer();
        console.log(`Time until data transfer: ${hours}h ${minutes}m ${seconds}s`);

        async function updateDownloadCounter() {
            const modrinthProjectId = '4H6sumDB';
            const curseforgeProjectId = '915902';

            try {
                const modrinthDownloads = await fetchModrinthDownloads(modrinthProjectId);
                const curseforgeDownloads = await fetchCurseforgeDownloads(curseforgeProjectId);
                const totalDownloads = modrinthDownloads + curseforgeDownloads;

                console.log(`Modrinth Downloads: ${modrinthDownloads}`);
                console.log(`Curseforge Downloads: ${curseforgeDownloads}`);
                console.log(`Total Downloads: ${totalDownloads}`);

                // Update DOM
                const downloadCounter = document.getElementById('download-counter');
                downloadCounter.innerText = totalDownloads.toLocaleString();

                const typedOutElement = document.getElementById('typed-out');
                typedOutElement.classList.add('animate');

                const currentTimestamp = Date.now();
                const dbRef = ref(database, 'totals');

                // Fetch previous data from the database
                const snapshot = await get(dbRef);
                const previousData = snapshot.exists() ? snapshot.val() : { 
                    timestamp: currentTimestamp, 
                    totalDownloads: totalDownloads, 
                    yesterdayDownloads: 0,
                    matchesLength: 0,
                };

                console.log('Previous Data:', previousData);
                console.log('Current Timestamp:', Date.now());
                const readableTimestamp = new Date(previousData.timestamp).toLocaleString();
                console.log('Previous Timestamp (Readable):', readableTimestamp);

                const daysPassed = (currentTimestamp - previousData.timestamp) / (1000 * 60 * 60 * 24);
                let newYesterdayDownloads = previousData.yesterdayDownloads;

                console.log(`Time since last update: ${Math.floor(daysPassed * 24)} hours and ${Math.floor((daysPassed * 24 * 60) % 60)} minutes`);

                const downloadDifference = totalDownloads - previousData.totalDownloads;

                // Update additional DOM elements
                const dailyAvgElement = document.getElementById('daily-avg');
                const modrinthDownloadsElement = document.getElementById('modrinth-downloads');
                const curseforgeDownloadsElement = document.getElementById('curseforge-downloads');

                dailyAvgElement.innerText = `Yesterday's Downloads: ${newYesterdayDownloads.toLocaleString()}`;
                modrinthDownloadsElement.innerText = `Modrinth Downloads: ${modrinthDownloads.toLocaleString()}`;
                curseforgeDownloadsElement.innerText = `CurseForge Downloads: ${curseforgeDownloads.toLocaleString()}`;

                dailyAvgElement.style.transition = "opacity 0.2s ease"; // Add transition to the element

                dailyAvgElement.addEventListener('mouseenter', () => {
                    dailyAvgElement.style.opacity = "0"; // Fade out
                    setTimeout(() => {
                        dailyAvgElement.innerText = "Today's Downloads: " + downloadDifference.toLocaleString();
                        dailyAvgElement.style.opacity = "1"; // Fade back in
                    }, 200); // Match the transition duration
                });

                dailyAvgElement.addEventListener('mouseleave', () => {
                    dailyAvgElement.style.opacity = "0"; // Fade out
                    setTimeout(() => {
                        dailyAvgElement.innerText = "Yesterday's Downloads: " + newYesterdayDownloads.toLocaleString();
                        dailyAvgElement.style.opacity = "1"; // Fade back in
                    }, 200); // Match the transition duration
                });
            } catch (error) {
                console.error('Error updating download counter:', error);
                document.getElementById('download-counter').innerText = 'Error';
            }
        }

        // Call the function
        updateDownloadCounter();
    </script>
    <script>
        const cursor = document.getElementById('custom-cursor');
        const navFooters = document.querySelectorAll('.download-count-nav-footer');
        let timeoutId = null;
        let isMobile = window.innerWidth <= 768;

        window.addEventListener('resize', () => {
            isMobile = window.innerWidth <= 768;
            if (isMobile) {
                navFooters.forEach(element => {
                    element.style.opacity = '1';
                });
            }
        });

        function updateCursor(e) {
            requestAnimationFrame(() => {
            cursor.style.transform = `translate3d(${e.clientX}px, ${e.clientY}px, 0) translate(-50%, -50%)`;
            });
            
            cursor.classList.remove('idle');
            if (!isMobile) {
                navFooters.forEach(element => {
                    element.style.transition = 'opacity 0.5s';
                    element.style.opacity = '1';
                });
            }
            
            if (timeoutId) {
                clearTimeout(timeoutId);
            }
            
            timeoutId = setTimeout(() => {
                cursor.classList.add('idle');
                if (!isMobile) {
                    navFooters.forEach(element => {
                        element.style.opacity = '0';
                    });
                }
            }, 3000);
        }

        // Add cursor tracking
        document.addEventListener('mousemove', updateCursor, { passive: true });

        // Add hover detection for download-counter-page
        const downloadCounter = document.querySelector('.download-counter-page');
        const headings = downloadCounter.querySelectorAll('h1, h2');
        const downloadDetails = downloadCounter.querySelector('#daily-avg');

        // Add hover for headings
        headings.forEach(heading => {
            heading.addEventListener('mouseenter', () => {
                cursor.classList.add('scaled');
            });

            heading.addEventListener('mouseleave', () => {
                cursor.classList.remove('scaled');
            });
        });

        // Add hover for download-details
        if (downloadDetails) {
            downloadDetails.addEventListener('mouseenter', () => {
                cursor.classList.add('scaled');
            });

            downloadDetails.addEventListener('mouseleave', () => {
                cursor.classList.remove('scaled');
            });
        }

        // Click effect
        document.addEventListener('mousedown', () => {
            cursor.classList.add('scaled');
            cursor.style.transform += ' scale(0.7)';
        });

        document.addEventListener('mouseup', () => {
            cursor.classList.remove('scaled');
            cursor.style.transform = cursor.style.transform.replace(' scale(0.7)', '');
        });


// Execute immediately without waiting for DOMContentLoaded
(function() {
        
        // Keep track of whether we've already patched things
        let functionPatched = false;
        let buttonFound = false;
        
        // Function to patch the updateCursor function
        function patchUpdateCursor() {
            if (functionPatched) return;
            
            const original = window.updateCursor;
            window.updateCursor = function(e) {
                // Call the original first
                original.call(this, e);
                
                // Find the cookie button
                const cookieButton = document.getElementById('cookie-settings-btn');
                if (!cookieButton) return;
                
                // Mark that we found the button
                if (!buttonFound) {
                    buttonFound = true;
                }
                
                // Apply the same behavior as navFooters
                if (!isMobile) {
                    cookieButton.style.transition = 'opacity 0.5s';
                    cookieButton.style.opacity = '1';
                    cookieButton.style.display = 'block';
                    cookieButton.style.visibility = 'visible';
                }
            };
            
            // Also patch setTimeout to catch the inactivity timer
            const originalSetTimeout = window.setTimeout;
            window.setTimeout = function(callback, delay) {
                if (delay === 3000 && callback.toString().includes('cursor.classList.add')) {
                    // This is likely the inactivity timer from updateCursor
                    const newCallback = function() {
                        // Run original callback
                        callback();
                        
                        // Also handle cookie button
                        const cookieButton = document.getElementById('cookie-settings-btn');
                        if (cookieButton && !isMobile) {
                            cookieButton.style.opacity = '0';
                        }
                    };
                    
                    return originalSetTimeout(newCallback, delay);
                }
                
                // For all other setTimeout calls, pass through unchanged
                return originalSetTimeout(callback, delay);
            };
            
            functionPatched = true;
        }
        
        // 1. Check if updateCursor already exists and patch it
        if (typeof window.updateCursor === 'function') {
            patchUpdateCursor();
        } 
        // 2. If not, set up a property descriptor to catch when it's defined
        else {
            let _updateCursor; // For storing the real function
            Object.defineProperty(window, 'updateCursor', {
                configurable: true,
                enumerable: true,
                get: function() { return _updateCursor; },
                set: function(newFunc) {
                    _updateCursor = newFunc;
                    patchUpdateCursor();
                }
            });
        }
        
        // 3. Also set up a direct event listener for mouse movement in case our patching fails
        document.addEventListener('mousemove', function(e) {
            const cookieButton = document.getElementById('cookie-settings-btn');
            if (cookieButton && !isMobile) {
                cookieButton.style.transition = 'opacity 0.5s';
                cookieButton.style.opacity = '1';
                cookieButton.style.display = 'block';
                cookieButton.style.visibility = 'visible';
            }
        });
        
        // 4. Periodically check if the cookie button exists and apply styles
        const styleInterval = setInterval(() => {
            const cookieButton = document.getElementById('cookie-settings-btn');
            if (cookieButton) {
                // Ensure transition is set
                cookieButton.style.transition = 'opacity 0.5s';
                
                // Match opacity with navFooters
                const navFooter = document.querySelector('.download-count-nav-footer');
                if (navFooter) {
                    const computedOpacity = window.getComputedStyle(navFooter).opacity;
                    cookieButton.style.opacity = computedOpacity;
                }
                
                buttonFound = true;
            }
        }, 500);
        
        // Stop interval after 10 seconds
        setTimeout(() => {
            clearInterval(styleInterval);
        }, 10000);
    })();


</script>



    

</body>
</html>
