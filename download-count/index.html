<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Basic Page Needs
    ================================================== -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="canonical" href="https://www.euphoriapatches.com/download-count/"/>

    <title>Download Count | Euphoria Patches</title>

    <meta name="description" content="Total Download Counter">
    <meta name="author" content="">
    <meta name="keywords" content="">

    <!-- Mobile Specific Metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=5.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">

    <!-- Favicon
    ================================================== -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/EuphoriaPatchesLogo_180x.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/EuphoriaPatchesLogo_16x.png">

    <!-- Stylesheets
    ================================================== -->
    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/assets/css/style.min.css" rel="stylesheet">
    <link href="/assets/css/responsive.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3CGSG92RGD"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-3CGSG92RGD');
    </script>
</head>
<body>
<div id="download-counter-all-page">
    <header id="masthead" class="site-header site-header-white">
        <nav id="primary-navigation" class="site-navigation">
            <div class="container">

                <div class="navbar-header">
                   
                    <a href="/" class="site-title"><span>Euphoria</span> Patches</a>

                </div><!-- /.navbar-header -->

                <div class="collapse navbar-collapse" id="agency-navbar-collapse">

                    <ul class="nav navbar-nav navbar-right">

                        <li><a href="/">Home</a></li>
                        <li><a href="/download">Download</a></li>
                        <li><a href="/support">Preview Versions</a></li>
                        <li><a href="/gallery">Gallery</a></li>
                        <li><a href="/changelogs">Changelogs</a></li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Information<i class="fa fa-caret-down hidden-xs" aria-hidden="true"></i></a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                              <li><a href="/contact">Contact</a></li>
                              <li><a href="/faq">FAQ</a></li>
                              <li><a href="/how-to-install">How To Install</a></li>
                              <li><a href="/credits">Credits</a></li>
                              <li><a href="/download-count/" style="color: var(--ThemeColor);">Download Count</a></li>
                              <li><a href="/privacy-policy">Privacy Policy</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>   
        </nav><!-- /.site-navigation -->
    </header><!-- /#mastheaed -->

    <main id="main" class="site-main download-page-main">
        <section class="site-section gradient-bg">
            <div class="download-counter-page">
                <h2>Total Downloads:</h2>
                <div class="total-download-number">
                    <div class="typed-out" id="typed-out">
                        <h1 id="download-counter">&nbsp;</h1>
                    </div>
                    <div id="download-details" class="download-details">
                        <div id="daily-avg"></div>
                        <div id="modrinth-downloads"></div>
                        <div id="curseforge-downloads"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>


    <footer id="colophon" class="site-footer"></footer>
        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-xs-8">
                        <div class="social-links">
                            <a class="discord-bg" href="/discord" target="_blank" alt="Discord Invite"></a>
                            <a class="patreon-bg" href="/support" target="_blank" alt="Patreon Link"></a>
                            <a class="github-bg" href="/github" target="_blank" alt="Github Link"></a>
                            <a class="contact-bg" href="/contact" target="_blank" alt="Contact Page Link">Contact</a>
                        </div><!-- /.social-links -->
                    </div>
                    <div class="col-xs-4 site-title">
                        <div class="text-right">
                            <a href="/">Euphoria Patches</a>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- /.copyright -->
    </footer><!-- /#footer -->
</div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/bootstrap-select.min.js"></script>
    <script src="/assets/js/jquery.slicknav.min.js"></script>
    <script src="/assets/js/jquery.countTo.min.js"></script>
    <script src="/assets/js/jquery.shuffle.min.js"></script>
    <script src="/assets/js/script.js"></script>

    <script>
        async function fetchModrinthDownloads(projectId) {
            try {
                const response = await fetch(`https://api.modrinth.com/v2/project/${projectId}`);
                const data = await response.json();
                return data.downloads || 0;
            } catch (error) {
                console.error('Error fetching Modrinth downloads:', error);
                return 0;
            }
        }

        async function fetchCurseforgeDownloads(projectId) {
            try {
                const response = await fetch(`https://api.curseforge.com/v1/mods/${projectId}`, {
                    headers: {
                        'Accept': 'application/json',
                        'x-api-key': '$2a$10$izPaCsTGxUGv.3h62ZixYelNErqfLizoCjVJphyCNFs00riMLc5wK' // Replace with your actual API key
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Curseforge API request failed');
                }
                
                const data = await response.json();
                return data.data.downloadCount || 0;
            } catch (error) {
                console.error('Error fetching Curseforge downloads:', error);
                return 0;
            }
        }

        async function updateDownloadCounter() {
            const modrinthProjectId = '4H6sumDB';
            const curseforgeProjectId = '915902';

            try {
                // Fetch downloads from both platforms
                const modrinthDownloads = await fetchModrinthDownloads(modrinthProjectId);
                const curseforgeDownloads = await fetchCurseforgeDownloads(curseforgeProjectId);

                // Calculate total downloads
                const totalDownloads = modrinthDownloads + curseforgeDownloads;
                
                // Update the download counter element
                const downloadCounter = document.getElementById('download-counter');
                downloadCounter.innerText = totalDownloads.toLocaleString();

                const typedOutElement = document.getElementById('typed-out');
                typedOutElement.classList.add('animate');

                // Calculate and display daily average
                const dailyAvgElement = document.getElementById('daily-avg');
                const modrinthDownloadsElement = document.getElementById('modrinth-downloads');
                const curseforgeDownloadsElement = document.getElementById('curseforge-downloads');

                // Check if we have a previous download count stored
                const storedDownloadsKey = 'euphoria-total-downloads';
                const storedTimestampKey = 'euphoria-downloads-timestamp';
                
                const storedDownloads = localStorage.getItem(storedDownloadsKey);
                const storedTimestamp = localStorage.getItem(storedTimestampKey);
                const currentTimestamp = Date.now();

                let dailyAverage = 0;

                if (storedDownloads && storedTimestamp) {
                    const daysPassed = (currentTimestamp - parseInt(storedTimestamp)) / (1000 * 60 * 60 * 24);
                    
                    if (daysPassed >= 1) {
                        const downloadDifference = totalDownloads - parseInt(storedDownloads);
                        dailyAverage = Math.round(downloadDifference / daysPassed);
                    }
                }

                // Update localStorage
                localStorage.setItem(storedDownloadsKey, totalDownloads.toString());
                localStorage.setItem(storedTimestampKey, currentTimestamp.toString());

                // Populate download details
                // dailyAvgElement.innerText = `Daily Average: ${dailyAverage.toLocaleString()} downloads`;
                modrinthDownloadsElement.innerText = `Modrinth Downloads: ${modrinthDownloads.toLocaleString()}`;
                curseforgeDownloadsElement.innerText = `CurseForge Downloads: ${curseforgeDownloads.toLocaleString()}`;

                return totalDownloads;
            } catch (error) {
                console.error('Error updating download counter:', error);
                document.getElementById('download-counter').innerText = 'Error';
            }
        }

        // Call the function to update downloads
        updateDownloadCounter();
    </script>

</body>
</html>
